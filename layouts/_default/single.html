{{ define "breadcrumb" }}
  {{ partial "breadcrumb.html" . }}
{{ end }}
{{ define "main" }}
  <article class="h-entry" id="skip-to-content" aria-labelledby="{{ anchorize .Title }}">
    <header aria-labelledby="{{ anchorize .Title }}">
      <hgroup>
        <h1 class="p-name" id="{{ anchorize .Title }}">{{ .Title }}</h1>
        {{- if .Params.title_sub }}
          <h2>{{ .Params.title_sub }}</h2>
          {{- with .Params.headline }}<h3>{{ . }}</h3>{{- end }}
        {{- else }}
          {{- with .Params.headline }}<h2>{{ . }}</h2>{{- end }}
        {{- end }}
      </hgroup>
    </header>
    <section class="content e-content" aria-label="Content">
      {{ .Content }}
    </section>
    <footer aria-label="Metadata and Related Posts">
      <nav aria-labelledby="skip-to-posts-metadata">
        <h2 id="skip-to-posts-metadata">Metadata</h2>
        <dl class="metadata">
          <dt>Published</dt><dd><time class="dt-published" datetime="{{ dateFormat $.Site.Params.iso8601_format .Date }}">{{ dateFormat "2006-01-02" .Date }}</time></dd>
          {{ if ne .Lastmod .Date }}<dt><ins>Updated</ins><dd><ins><time class="dt-updated" datetime="{{ .Lastmod.Format $.Site.Params.iso8601_format }}">{{ .Lastmod.Format "2006-01-02" }}</time></ins></dd>{{ end }}
          {{- with .Params.tags }}
            <dt id="skip-to-tags">Tags</dt>
            {{- range . }}
              <dd><a rel="tag" class="p-category" aria-label="Posts tagged with “{{ . }}”" href="{{ "tags" | absURL }}/{{ . | urlize }}">#{{ . | anchorize }}</a></dd>
            {{- end }}
          {{- end }}
          <dt>Author</dt><dd class="u-author p-author h-card"><a rel="author" class="u-url p-name" href="{{ .Site.BaseURL }}">{{ .Site.Params.copyrightHolder }}</a></dd>
          <dt>Permalink</dt><dd><a href="{{ .Permalink }}" rel="bookmark" class="u-url">{{ .Permalink }}</a></dd>
        {{- with .Params.series }}
          {{- range (where $.Site.Data.series "key" "eq" .) }}
            {{- $title := .title }}
            <dt>Series</dt><dd><a name='skip-to-series-navigation' href="{{ "series" | absURL }}/{{ .key | urlize }}" rel="bookmark">{{ $title }}</a></dd>
            {{- $series := where $.Site.Pages "Params.series" .key }}
            {{- $prev := where $series ".PublishDate" "lt" $.Page.PublishDate }}
            {{- range first 1 $prev }}
              <dt>Previous in Series</dt><dd><a rel="prev" title="{{ .Title }}" href="{{ .Permalink }}"><cite>{{ .Title }}</cite></a></dd>
            {{- end}}
            {{- $next := where $series ".PublishDate" "gt" $.Page.PublishDate }}
            {{- range last 1 $next }}
              <dt>Next in Series</dt><dd><a rel="next" title="{{ .Title }}" href="{{ .Permalink }}"><cite>{{ .Title }}</cite></a></dd>
            {{- end}}
          {{- end}}
        {{- end }}
        {{- with .Params.webmentions }}
          <dt id="skip-to-webmentions">Web mentions</dt>
          {{- range . }}
            <dd><a href="{{ . }}" rel="nofollow">{{ . }}</a></dd>
          {{- end }}
        {{- end }}
      </dl>

      </nav>
      <nav aria-labelledby="skip-to-related-posts">
        <h2 id="skip-to-related-posts">Related Posts</h2>
        <ul>
          {{ range first 5 (.Site.RegularPages.Related .) }}
            <li>
              <a aria-label="Related post: {{ .Title }}" href="{{ .RelPermalink }}"><cite>{{ .Title | markdownify }}</cite></a>
            </li>
          {{ end }}
        </ul>
      </nav>
    </footer>
  </article>
{{ end }}
